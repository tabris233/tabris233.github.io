<!DOCTYPE html><html lang="zh-CN"><head hexo-theme="https://github.com/volantis-x/hexo-theme-volantis/tree/4.3.1"><meta charset="utf-8"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="preload" href="/css/first.css" as="style"><title>[原创]SPOJ FTOUR2 - Free tour II [点分治+启发式合并]【分治】 - tabris的博客</title><meta name="keywords" content="CSDN"><meta name="description" content="[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】
2017-07-18 09:10:38  Tabris_ 阅读数：892

博客爬取于2020-06-14 22:39:37以下为正文
版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。https://b..."><link rel="alternate" href="/atom.xml" title="tabris的博客" type="application/atom+xml"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-config" content="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/favicon/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="apple-touch-icon" sizes="180x180" href="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/favicon/favicon-16x16.png"><link rel="manifest" href="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/favicon/site.webmanifest"><link rel="mask-icon" href="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/favicon/safari-pinned-tab.svg" color="#5bbad5"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/favicon/favicon.ico"><link rel="stylesheet" href="/css/first.css"><link rel="stylesheet" href="/css/style.css" media="print" onload='this.media="all",this.onload=null'><noscript><link rel="stylesheet" href="/css/style.css"></noscript><script>window.MSInputMethodContext&&document.documentMode&&document.write('<style>html{overflow-x: hidden !important;overflow-y: hidden !important;}.kill-ie{text-align:center;height: 100%;margin-top: 15%;margin-bottom: 5500%;}</style><div class="kill-ie"><h1><b>抱歉，您的浏览器无法访问本站</b></h1><h3>微软已经于2016年终止了对 Internet Explorer (IE) 10 及更早版本的支持，<br/>继续使用存在极大的安全隐患，请使用当代主流的浏览器进行访问。</h3><br/><a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/WindowsForBusiness/End-of-IE-support"><strong>了解详情 ></strong></a></div>')</script><noscript><style>html{overflow-x:hidden!important;overflow-y:hidden!important}.kill-noscript{text-align:center;height:100%;margin-top:15%;margin-bottom:5500%}</style><div class="kill-noscript"><h1><b>抱歉，您的浏览器无法访问本站</b></h1><h3>本页面需要浏览器支持（启用）JavaScript</h3><br> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.baidu.com/s?wd=启用JavaScript"><strong>了解详情 ></strong></a></div></noscript></head><body><header id="l_header" class="l_header auto shadow blur show" style="opacity:0"><div class="container"><div id="wrapper"><div class="nav-sub"><p class="title"></p><ul class="switcher nav-list-h m-phone" id="pjax-header-nav-list"><li><a id="s-comment" class="fas fa-comments fa-fw" target="_self" href="javascript:void(0)"></a></li><li><a id="s-toc" class="s-toc fas fa-list fa-fw" target="_self" href="javascript:void(0)"></a></li></ul></div><div class="nav-main"><a class="title flat-box" target="_self" href="/"><i class="https://cdn.jsdelivr.net/gh/tabris233/cdn-assets/avatar/avatar.jpg"></i> Tabris</a><div class="menu navigation"><ul class="nav-list-h m-pc"><li><a class="menuitem flat-box faa-parent animated-hover" href="/" id="home"><i class="fas fa-home fa-fw"></i> 首页</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/" id="categories"><i class="fas fa-folder-open fa-fw"></i> 分类</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/tags/" id="tags"><i class="fas fa-tags fa-fw"></i> 标签</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/archives/" id="archives"><i class="fas fa-archive fa-fw"></i> 归档</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/friends/" id="friends"><i class="fas fa-link fa-fw"></i> 友链</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/about/" id="about"><i class="fas fa-info-circle fa-fw"></i> 关于</a></li><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fas fa-book fa-fw"></i> 待整理</a><ul class="list-v"><li><a class="menuitem flat-box header toggle-mode-btn"><i class="fas fa-moon fa-fw"></i> 暗黑模式</a></li><li></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/" id="categories"><i class="fas fa-folder-open fa-fw"></i> 分类</a></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="/tags/" id="tags"><i class="fas fa-tags fa-fw"></i> 标签</a></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="/archives/" id="archives"><i class="fas fa-archive fa-fw"></i> 归档</a></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="/friends/" id="friends"><i class="fas fa-link fa-fw"></i> 友链</a></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="/about/" id="about"><i class="fas fa-info-circle fa-fw"></i> 关于</a></li></ul></li></ul></div><div class="m_search"><form name="searchform" class="form u-search-form"><i class="icon fas fa-search fa-fw"></i> <input type="text" class="input u-search-input" placeholder="Search..."></form></div><ul class="switcher nav-list-h m-phone"><li><a class="s-search fas fa-search fa-fw" target="_self" href="javascript:void(0)"></a></li><li><a class="s-menu fas fa-bars fa-fw" target="_self" href="javascript:void(0)"></a><ul class="menu-phone list-v navigation white-box"><li><a class="menuitem flat-box faa-parent animated-hover" href="/" id="home"><i class="fas fa-home fa-fw"></i> 首页</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/" id="categories"><i class="fas fa-folder-open fa-fw"></i> 分类</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/tags/" id="tags"><i class="fas fa-tags fa-fw"></i> 标签</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/archives/" id="archives"><i class="fas fa-archive fa-fw"></i> 归档</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/friends/" id="friends"><i class="fas fa-link fa-fw"></i> 友链</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/about/" id="about"><i class="fas fa-info-circle fa-fw"></i> 关于</a></li><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fas fa-book fa-fw"></i> 待整理</a><ul class="list-v"><li><a class="menuitem flat-box header toggle-mode-btn"><i class="fas fa-moon fa-fw"></i> 暗黑模式</a></li><li></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/" id="categories"><i class="fas fa-folder-open fa-fw"></i> 分类</a></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="/tags/" id="tags"><i class="fas fa-tags fa-fw"></i> 标签</a></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="/archives/" id="archives"><i class="fas fa-archive fa-fw"></i> 归档</a></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="/friends/" id="friends"><i class="fas fa-link fa-fw"></i> 友链</a></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="/about/" id="about"><i class="fas fa-info-circle fa-fw"></i> 关于</a></li></ul></li></ul></li></ul></div></div></div></header><div id="l_body"><div id="l_cover"><div id="none" class="cover-wrapper post dock" style="display:none"><div id="parallax-window"></div><div class="cover-body"><div class="top"><p class="title">tabris blog</p><p class="subtitle">A Low Blog</p></div><div class="bottom"><div class="menu navigation"><div class="list-h"><a href="/" id="home"><i class="fas fa-home fa-fw"></i><p>首页</p></a><a href="/categories/" id="categories"><i class="fas fa-folder-open fa-fw"></i><p>分类</p></a><a href="/tags/" id="tags"><i class="fas fa-tags fa-fw"></i><p>标签</p></a><a href="/archives/" id="archives"><i class="fas fa-archive fa-fw"></i><p>归档</p></a><a href="/friends/" id="friends"><i class="fas fa-link fa-fw"></i><p>友链</p></a><a href="/about/" id="about"><i class="fas fa-info-circle fa-fw"></i><p>关于</p></a></div></div></div></div><div id="scroll-down" style="display:none"><i class="fa fa-chevron-down scroll-down-effects"></i></div></div></div><div id="safearea"><div class="body-wrapper" id="pjax-container"><div id="l_main" class><article class="article post white-box reveal md shadow article-type-post" id="post" itemscope itemprop="blogPost"><div class="article-meta" id="top"><h1 class="title"> [原创]SPOJ FTOUR2 - Free tour II [点分治+启发式合并]【分治】</h1><div class="new-meta-box"><div class="new-meta-item author"> <a class="author" href="/" rel="nofollow"><img no-lazy src="https://cdn.jsdelivr.net/gh/tabris233/cdn-assets/avatar/avatar.jpg"><p>Tabris</p></a></div><div class="new-meta-item category"><a class="notlink"><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i> <a class="category-link" href="/categories/csdn/">CSDN</a><span class="sep"></span><a class="category-link" href="/categories/csdn/%E5%88%86%E6%B2%BB/">分治</a><span class="sep"></span><a class="category-link" href="/categories/csdn/%E5%88%86%E6%B2%BB/spoj/">SPOJ</a></a></div><div class="new-meta-item date"><a class="notlink"><i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i><p>发布于：2017年7月18日</p></a></div><div class="new-meta-item browse leancloud"><a class="notlink"><div id="lc-pv" data-title="[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】" data-path="/2017-07-18-75270526/"><i class="fas fa-eye fa-fw" aria-hidden="true"></i><span id="number"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> 次浏览</div></a></div></div></div><p>[原创]SPOJ FTOUR2 - Free tour II [点分治+启发式合并]【分治】</p><p>2017-07-18 09:10:38 <a href="https://me.csdn.net/qq_33184171" target="_blank" rel="external nofollow noopener noreferrer">Tabris_</a> 阅读数：892</p><hr><p>博客爬取于<code>2020-06-14 22:39:37</code><br><em><strong>以下为正文</strong></em></p><p>版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。<br><a href="https://blog.csdn.net/qq_33184171/article/details/75270526" target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/qq_33184171/article/details/75270526</a></p><span id="more"></span><hr><p>题目链接：<a href="http://www.spoj.com/problems/FTOUR2/" target="_blank" rel="external nofollow noopener noreferrer">http://www.spoj.com/problems/FTOUR2/</a><br>—————————————————————————————————————<br>FTOUR2 - Free tour II<br>no tags<br>After the success of 2nd anniversary (take a look at problem FTOUR for more details), this 3rd year, Travel Agent SPOJ goes on with another discount tour.</p><p>The tour will be held on ICPC island, a miraculous one on the Pacific Ocean. We list N places (indexed from 1 to N) where the visitors can have a trip. Each road connecting them has an interest value, and this value can be negative (if there is nothing interesting to view there). Simply, these N places along with the roads connecting them form a tree structure. We will choose two places as the departure and destination of the tour.</p><p>Since September is the festival season of local inhabitants, some places are extremely crowded (we call them crowded places). Therefore, the organizer of the excursion hopes the tour will visit at most K crowded places (too tiring to visit many of them) and of course, the total number of interesting value should be maximum.</p><p>Briefly, you are given a map of N places, an integer K, and M id numbers of crowded place. Please help us to find the optimal tour. Note that we can visit each place only once (or our customers easily feel bored), also the departure and destination places don&#39;t need to be different.</p><p>Input</p><p>There is exactly one case. First one line, containing 3 integers N K M, with 1 &lt;= N &lt;= 200000, 0 &lt;= K &lt;= M, 0 &lt;= M &lt;= N.</p><p>Next M lines, each line includes an id number of a crowded place.</p><p>The last (N - 1) lines describe (N - 1) two-way roads connected N places, form a b i, with a, b is the id of 2 places, and i is its interest value (-10000 &lt;= i &lt;= 10000).</p><p>Output</p><p>Only one number, the maximum total interest value we can obtain.</p><p>Example</p><p>Input:<br>8 2 3<br>3<br>5<br>7<br>1 3 1<br>2 3 10<br>3 4 -2<br>4 5 -1<br>5 7 6<br>5 6 5<br>4 8 3</p><p>Output:<br>12<br>Explanation</p><p>We choose 2 and 6 as the departure and destination place, so the tour will be 2 -&gt; 3 -&gt; 4 -&gt; 5 -&gt; 6, total interest value = 10 + (-2) + (-1) + 5 = 12</p><ul><li>Added some unofficial cases<br>——————————————————————————————————————</li></ul><p>题目大意：<br>给你一棵树，树上的节点有白点有黑点，其中找到一条路径使得在经过的黑色点数<strong>不超过K</strong>的时候 路径长度最大，输出这个最大值</p><hr><h2 id="最好去看论文-gt-戳这里"><a href="#最好去看论文-gt-戳这里" class="headerlink" title="最好去看论文===&gt;戳这里"></a><strong>最好去看论文===&gt;<a href="https://wenku.baidu.com/view/e932a21614791711cc791725.html" target="_blank" rel="external nofollow noopener noreferrer">戳这里</a></strong></h2><p><strong>注意! 注意! 这里最小值要初始化为0,而不是-INF,可以路径上只有一个点.....wa到死有没有!!!</strong></p><p>还是采用点分治,</p><p>首先 对于每个子树 找 经过根节点的 满足条件 最大值</p><p>可以想到在遍历子树的时候<br>维护一个$mx[i]$ 记录当前节点到根节点经过i个【黑】点时的距离<br>处理出一个前缀最大值 然后就能O(k/2)的计算 当前最大值</p><p>但是问题时如何 避免以根节点儿子为根的子树中的不满足的值</p><p>笨想就是 枚举两个子树 然后维护，但显然这部分复杂度是$O(n^2)$的</p><p>然后就像 其实对一个子树来说 就是要找它和除这个子树外的其他子树的最大值的和</p><p>对于n个子树来说 直接将前i-1的结果个合并,<br>然后就能直接维护第i个子树的答案了</p><p>然后这部分操作 $O([u].size()*k)$</p><p>然后采用优化策略 只有,找到对每个以根节点儿子为根的子树中 经过最多的黑色点的路径中黑色点数为A,由于A大于K的地方对结果无贡献,就不用计算了, 这里算一个剪枝.</p><p>然后对前i-1个结果合并的时候 采取启发式合并,先合并小的,在合并大的,这样的话 维护下来 $mx[i]$ 中$i$的上届会递增,能够优化.</p><p>最后总复杂度就是$O(n\log n)$ [详细复杂度分析请移步国家队论文↑]</p><p>附本题代码<br>——————————————————————————————————————</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># include &lt;bits&#x2F;stdc++.h&gt;</span><br><span class="line">typedef long long int LL;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">const int N &#x3D; 200000+7;</span><br><span class="line">const int INF &#x3D; (~(1&lt;&lt;31));</span><br><span class="line"></span><br><span class="line">inline int read()&#123;</span><br><span class="line">    int x&#x3D;0,f&#x3D;1;char ch &#x3D; getchar();</span><br><span class="line">    for(;ch&lt;&#39;0&#39;||&#39;9&#39;&lt;ch;ch&#x3D;getchar()) if(ch&#x3D;&#x3D;&#39;-&#39;) f&#x3D;-1;</span><br><span class="line">    for(;&#39;0&#39;&lt;&#x3D;ch&amp;&amp;ch&lt;&#x3D;&#39;9&#39;;ch&#x3D;getchar()) x&#x3D;(x&lt;&lt;3)+(x&lt;&lt;1)+ch-&#39;0&#39;;</span><br><span class="line">    return x*f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;*************************************************************&#x2F;</span><br><span class="line"></span><br><span class="line">int n,k,m,ans;</span><br><span class="line"></span><br><span class="line">bool vis[N];</span><br><span class="line">int black[N];</span><br><span class="line"></span><br><span class="line">struct edge&#123;</span><br><span class="line">    int to,next;</span><br><span class="line">    int w;</span><br><span class="line">&#125;G[N&lt;&lt;1];</span><br><span class="line">int head[N],tot;</span><br><span class="line">void add(int u,int v,int w&#x3D;0)&#123;</span><br><span class="line">    G[tot].w&#x3D;w,G[tot].to&#x3D;v,G[tot].next&#x3D;head[u],head[u]&#x3D;tot++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;********重心 begin********&#x2F;</span><br><span class="line">int sz[N],dn[N],siz,zx;</span><br><span class="line"></span><br><span class="line">void getzx(int u,int fa&#x3D;0)&#123;</span><br><span class="line">    sz[u]&#x3D;1;dn[u]&#x3D;0;</span><br><span class="line">    for(int i&#x3D;head[u],to;i!&#x3D;-1;i&#x3D;G[i].next)&#123;</span><br><span class="line">        to &#x3D; G[i].to;</span><br><span class="line">        if(to &#x3D;&#x3D; fa||vis[to]) continue;&#x2F;&#x2F;puts(&quot;---+++---&quot;);</span><br><span class="line">        getzx(to,u);</span><br><span class="line">        sz[u]+&#x3D;sz[to];</span><br><span class="line">        dn[u]&#x3D;max(dn[u],sz[to]);</span><br><span class="line">    &#125;</span><br><span class="line">    dn[u]&#x3D;max(dn[u],siz-sz[u]);</span><br><span class="line">    if(dn[u]&lt;dn[zx]) zx&#x3D;u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;*********重心 end********&#x2F;</span><br><span class="line"></span><br><span class="line">int dep[N],dis[N],deep_mx;</span><br><span class="line">void getdis(int u,int fa&#x3D;0)&#123;</span><br><span class="line">    deep_mx&#x3D;max(deep_mx,dep[u]);</span><br><span class="line">    for(int i&#x3D;head[u],to;i!&#x3D;-1;i&#x3D;G[i].next)&#123;</span><br><span class="line">        to &#x3D; G[i].to;</span><br><span class="line">        if(vis[to]||to&#x3D;&#x3D;fa)continue;</span><br><span class="line">        dep[to]&#x3D;dep[u]+black[to];</span><br><span class="line">        dis[to]&#x3D;dis[u]+G[i].w;</span><br><span class="line">        getdis(to,u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int tmp[N],mx[N];</span><br><span class="line">void getmx(int u,int fa&#x3D;0)&#123;</span><br><span class="line">    tmp[dep[u]]&#x3D;max(tmp[dep[u]],dis[u]);</span><br><span class="line">    for(int i&#x3D;head[u],to;i;i&#x3D;G[i].next)&#123;</span><br><span class="line">        to &#x3D; G[i].to;</span><br><span class="line">        if(vis[to]||to&#x3D;&#x3D;fa)continue;</span><br><span class="line">        getmx(to,u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vector&lt;pair&lt;int,int&gt; &gt;v;</span><br><span class="line">void solve(int u)&#123;</span><br><span class="line">    vis[u]&#x3D;1;if(black[u]) k--; v.clear();</span><br><span class="line"></span><br><span class="line">    int l&#x3D;0;</span><br><span class="line">    for(int i&#x3D;head[u],to;i!&#x3D;-1;i&#x3D;G[i].next)&#123;</span><br><span class="line">        to&#x3D;G[i].to; if(vis[to]) continue;</span><br><span class="line">        deep_mx &#x3D; 0;</span><br><span class="line">        dep[to]&#x3D;black[to];</span><br><span class="line">        dis[to]&#x3D;G[i].w;</span><br><span class="line">        getdis(to,u);</span><br><span class="line">        v.push_back(make_pair(deep_mx,to));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sort(v.begin(),v.end());</span><br><span class="line"></span><br><span class="line">    for(int i&#x3D;0,now;i&lt;v.size();i++)&#123;</span><br><span class="line">        getmx(v[i].second,u);</span><br><span class="line">        now &#x3D; 0;</span><br><span class="line">        if(i)&#123;</span><br><span class="line">            for(int j&#x3D;v[i].first;j&gt;&#x3D;0;j--)&#123;</span><br><span class="line">                while(now+j&lt;k&amp;&amp;now&lt;v[i-1].first)</span><br><span class="line">                    now++,mx[now]&#x3D;max(mx[now],mx[now-1]);</span><br><span class="line">                if(now+j&lt;&#x3D;k) ans&#x3D;max(ans,mx[now]+tmp[j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(i&#x3D;&#x3D;v.size()-1)&#123;</span><br><span class="line">            for(int j&#x3D;0;j&lt;&#x3D;v[i].first;j++)&#123;</span><br><span class="line">                if(j&lt;&#x3D;k) ans &#x3D; max(max(tmp[j],mx[j]),ans);</span><br><span class="line">                tmp[j]&#x3D;mx[j]&#x3D;0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            for(int j&#x3D;0;j&lt;&#x3D;v[i].first;j++)</span><br><span class="line">                mx[j]&#x3D;max(mx[j],tmp[j]),tmp[j]&#x3D;0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if(black[u])k++;</span><br><span class="line">    for(int i&#x3D;head[u],to;i!&#x3D;-1;i&#x3D;G[i].next)&#123;</span><br><span class="line">        to&#x3D;G[i].to;</span><br><span class="line">        if(vis[to]) continue;</span><br><span class="line">        siz&#x3D;sz[to],zx&#x3D;0;getzx(to);</span><br><span class="line">        solve(zx);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">    memset(head,-1,sizeof(head));</span><br><span class="line">   zx&#x3D;0;  tot &#x3D; 0;</span><br><span class="line"></span><br><span class="line">    n&#x3D;read(),k&#x3D;read(),m&#x3D;read();</span><br><span class="line">    for(int i&#x3D;1;i&lt;&#x3D;m;i++) black[read()]&#x3D;1;</span><br><span class="line"></span><br><span class="line">    for(int i&#x3D;1,u,v,w;i&lt;n;i++)&#123;</span><br><span class="line">        u&#x3D;read(),v&#x3D;read(),w&#x3D;read();</span><br><span class="line">        add(u,v,w);add(v,u,w);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dn[0]&#x3D;n;</span><br><span class="line">    siz &#x3D; n; getzx(1);</span><br><span class="line">&#x2F;&#x2F;    printf(&quot;tot &#x3D; %d zx &#x3D; %d\n&quot;,tot,zx);</span><br><span class="line">&#x2F;&#x2F;    for(int i&#x3D;1;i&lt;&#x3D;n;i++)</span><br><span class="line">&#x2F;&#x2F;        printf(&quot;dn[%d] &#x3D; %d sz[%d] &#x3D; %d\n&quot;,i,dn[i],i,sz[i]);</span><br><span class="line"></span><br><span class="line">    ans &#x3D; 0; solve(zx);</span><br><span class="line"></span><br><span class="line">    printf(&quot;%d\n&quot;,ans);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="footer"><div class="copyright"><blockquote><p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p><p>本文永久链接是：<a href="http://blog.tabris.top/2017-07-18-75270526/">http://blog.tabris.top/2017-07-18-75270526/</a></p></blockquote></div></div><div class="article-meta" id="bottom"><div class="new-meta-box"><div class="new-meta-item date" itemprop="dateUpdated" datetime="2021-05-01T15:52:49+00:00"><a class="notlink"><i class="fas fa-edit fa-fw" aria-hidden="true"></i><p>本页文档最后更新于：2021年5月1日</p></a></div><div class="new-meta-item meta-tags"><a class="tag" href="/tags/csdn/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>CSDN</p></a></div><div class="new-meta-item share -mob-share-list"><div class="-mob-share-list share-body"> <a class="-mob-share-qq" title rel="external nofollow noopener noreferrer" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.tabris.top/2017-07-18-75270526/&title=[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】 - tabris的博客&summary=[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】
2017-07-18 09:10:38  Tabris_ 阅读数：892

博客爬取于2020-06-14 22:39:37以下为正文
版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。https://blog.csdn.net/qq_33184171/article/details/75270526"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a> <a class="-mob-share-qzone" title rel="external nofollow noopener noreferrer" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.tabris.top/2017-07-18-75270526/&title=[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】 - tabris的博客&summary=[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】
2017-07-18 09:10:38  Tabris_ 阅读数：892

博客爬取于2020-06-14 22:39:37以下为正文
版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。https://blog.csdn.net/qq_33184171/article/details/75270526"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a> <a class="-mob-share-weibo" title rel="external nofollow noopener noreferrer" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.tabris.top/2017-07-18-75270526/&title=[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】 - tabris的博客&summary=[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】
2017-07-18 09:10:38  Tabris_ 阅读数：892

博客爬取于2020-06-14 22:39:37以下为正文
版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。https://blog.csdn.net/qq_33184171/article/details/75270526"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a></div></div></div></div><div class="prev-next"><a class="prev" href="/2017-07-18-75331107/"><p class="title"><i class="fas fa-chevron-left" aria-hidden="true"></i>[原创]第七届福建省赛 【(5+2)/10】</p><p class="content">[原创]第七届福建省赛 【(5+2)/10】 2017-07-18 21:46:10 Tabris_ 阅读数：560 博客爬取于2020-06-14 22:39:36以下为正文 版权声明：本...</p></a><a class="next" href="/2017-07-17-75267826/"><p class="title">[原创]POJ 1741 Tree [点分治入门题]【分治】<i class="fas fa-chevron-right" aria-hidden="true"></i></p><p class="content">[原创]POJ 1741 Tree [点分治入门题]【分治】 2017-07-17 20:37:58 Tabris_ 阅读数：375 博客爬取于2020-06-14 22:39:38以下为正...</p></a></div></article><article class="post white-box reveal shadow" id="comments"><p ct><i class="fas fa-comments"></i> 评论</p><div id="valine_container" class="valine_thread"><i class="fas fa-cog fa-spin fa-fw fa-2x"></i></div></article><script>"undefined"==typeof MathJax?(window.MathJax={loader:{source:{"[tex]/amsCd":"[tex]/amscd","[tex]/AMScd":"[tex]/amscd"}},tex:{inlineMath:{"[+]":[["$","$"]]},tags:"ams"},options:{renderActions:{findScript:[10,e=>{document.querySelectorAll('script[type^="math/tex"]').forEach(t=>{const a=!!t.type.match(/; *mode=display/),n=new e.options.MathItem(t.textContent,e.inputJax[0],a),d=document.createTextNode("");t.parentNode.replaceChild(d,t),n.start={node:d,delim:"",n:0},n.end={node:d,delim:"",n:0},e.math.push(n)})},"",!1],insertedScript:[200,()=>{document.querySelectorAll("mjx-container").forEach(e=>{let t=e.parentNode;"li"===t.nodeName.toLowerCase()&&t.parentNode.classList.add("has-jax")})},"",!1]}}},function(){var e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/mathjax@3.0/es5/tex-mml-chtml.js",e.defer=!0,document.head.appendChild(e)}()):(MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset())</script></div><aside id="l_side"><section class="widget blogger shadow desktop mobile"><div class="content"> <a class="avatar flat-box rectangle" href="/about/"><img no-lazy src="https://cdn.jsdelivr.net/gh/tabris233/cdn-assets/avatar/avatar.jpg"></a><div class="text"><h2>tabris's blog</h2><p>Tabris</p><p><span id="jinrishici-sentence">tabris的博客</span></p><script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script></div><div class="social-wrapper"><a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a><a href="mailto:tabris.dq@qq.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a><a href="https://github.com/tabris233/" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a><a href="/" class="social fas fa-headphones-alt flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a></div></div></section><section class="widget toc-wrapper shadow desktop mobile" id="toc-div"><header><i class="fas fa-list fa-fw" aria-hidden="true"></i> <span class="name">本文目录</span></header><div class="content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E5%A5%BD%E5%8E%BB%E7%9C%8B%E8%AE%BA%E6%96%87-gt-%E6%88%B3%E8%BF%99%E9%87%8C"><span class="toc-number">1.</span> <span class="toc-text">最好去看论文&#x3D;&#x3D;&#x3D;&gt;戳这里</span></a></li></ol></div></section></aside><script>window.pdata={},pdata.ispage=!0,pdata.postTitle="[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】",pdata.commentPath="",pdata.commentPlaceholder="";var l_header=document.getElementById("l_header");l_header.classList.add("show");var cover_wrapper=document.querySelector("#l_cover .cover-wrapper"),scroll_down=document.getElementById("scroll-down");cover_wrapper.id="none",cover_wrapper.style.display="none",scroll_down.style.display="none"</script></div><footer class="footer clearfix"><br><br><div class="aplayer-container"><meting-js theme="#1BCDFC" autoplay="true" volume="0.4" loop="all" order="random" fixed="false" list-max-height="320px" server="netease" type="playlist" id="3175833810" list-folded="true"></meting-js></div><br><div class="social-wrapper"><a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a><a href="mailto:tabris.dq@qq.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a><a href="https://github.com/tabris233" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a><a href="https://music.163.com/#/user/home?id=63035382" class="social fas fa-headphones-alt flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a></div><div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="external nofollow noopener noreferrer">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p></div><div><p><span id="lc-sv">本站总访问量为<span id="number"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> 次</span> <span id="lc-uv">访客数为<span id="number"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> 人</span></p></div> 本站使用 <a href="https://github.com/volantis-x/hexo-theme-volantis/tree/4.3.1" target="_blank" class="codename" rel="external nofollow noopener noreferrer">Volantis</a> 作为主题<div><p><a>粤ICP备</a> <a href="https://beian.miit.gov.cn" target="_blank" rel="external nofollow noopener noreferrer">2021020563号</a></p></div><div class="copyright"><p><a href="http://tabris.top/" target="_blank" rel="noopener external nofollow noreferrer">Copyright © 2017-2021 tabris</a></p></div></footer><a id="s-top" class="fas fa-arrow-up fa-fw" href="javascript:void(0)"></a></div></div><div><script>function RunItem(){function t(t,e){this.name=e||t.name,this.run=()=>{try{t()}catch(t){console.log(t)}}}this.list=[],this.start=()=>{for(var t=0;t<this.list.length;t++)this.list[t].run()},this.push=(e,n)=>{var s=new t(e,n);this.list.push(s)}}function loadScript(t,e){setTimeout((function(){var n=document.getElementsByTagName("head")[0]||document.documentElement,s=document.createElement("script");s.setAttribute("type","text/javascript"),e&&(s.onload=e),s.setAttribute("src",t),n.appendChild(s)}))}window.volantis={},volantis.$={},volantis.pjax={},volantis.pjax.method={complete:new RunItem,error:new RunItem,send:new RunItem},volantis.pjax={...volantis.pjax,push:volantis.pjax.method.complete.push,error:volantis.pjax.method.error.push,send:volantis.pjax.method.send.push},volantis.dark={},volantis.dark.method={toggle:new RunItem},volantis.dark={...volantis.dark,push:volantis.dark.method.toggle.push},volantis.plugins={jQuery:"https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js",sitesjs:"/js/plugins/sites.js",friendsjs:"/js/plugins/friends.js",contributorsjs:"/js/plugins/contributors.js"};var loadCSS=function(t,e,n,s){var i,o=window.document,r=o.createElement("link");if(e)i=e;else{var a=(o.body||o.getElementsByTagName("head")[0]).childNodes;i=a[a.length-1]}var l=o.styleSheets;if(s)for(var d in s)s.hasOwnProperty(d)&&r.setAttribute(d,s[d]);r.rel="stylesheet",r.href=t,r.media="only x",function t(e){if(o.body)return e();setTimeout((function(){t(e)}))}((function(){i.parentNode.insertBefore(r,e?i:i.nextSibling)}));var u=function(t){for(var e=r.href,n=l.length;n--;)if(l[n].href===e)return t();setTimeout((function(){u(t)}))};function h(){r.addEventListener&&r.removeEventListener("load",h),r.media=n||"all"}return r.addEventListener&&r.addEventListener("load",h),r.onloadcssdefined=u,u(h),r}</script><script>loadCSS("https://cdn.jsdelivr.net/gh/volantis-x/cdn-fontawesome-pro@master/css/all.min.css")</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script><script>function pjax_fancybox(){$(".md .gallery").find("img").each((function(){var a=document.createElement("a");$(a).attr("class","fancybox"),$(a).attr("pjax-fancybox",""),$(a).attr("href",$(this).attr("src")),$(this).attr("data-original")&&$(a).attr("href",$(this).attr("data-original")),$(a).attr("data-fancybox","images");var t="";$(this).attr("alt")&&"image"!==$(this).attr("alt")&&($(a).attr("data-caption",$(this).attr("alt")),t=$(this).attr("alt"));var n=document.createElement("div");$(n).addClass("fancybox"),$(this).wrap(n);var o=document.createElement("span");$(o).addClass("image-caption"),$(o).text(t),$(this).after(o),$(this).wrap(a)})),$(".md .gallery").find("img").fancybox({selector:'[data-fancybox="images"]',hash:!1,loop:!1,closeClick:!0,helpers:{overlay:{closeClick:!0}},buttons:["zoom","close"]})}function SCload_fancybox(){0!=$(".md .gallery").find("img").length&&(loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"),loadScript("https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js",pjax_fancybox))}function Pjax_SCload_fancybox(){void 0===$.fancybox?SCload_fancybox():pjax_fancybox()}$((function(){SCload_fancybox()})),volantis.pjax.push(Pjax_SCload_fancybox),volantis.pjax.send(()=>{void 0!==$.fancybox&&$.fancybox.close()},"fancybox")</script><div id="rightmenu-wrapper"><ul class="list-v rightmenu" id="rightmenu-content"><li class="navigation menuNavigation-Content"><a class="nav icon-only fix-cursor-default" onclick="history.back()"><i class="fa fa-arrow-left fa-fw"></i></a><a class="nav icon-only fix-cursor-default" onclick="history.forward()"><i class="fa fa-arrow-right fa-fw"></i></a><a class="nav icon-only fix-cursor-default" onclick="window.location.reload()"><i class="fa fa-redo fa-fw"></i></a><a class="nav icon-only fix-cursor-default" href="/"><i class="fa fa-home fa-fw"></i></a></li><li class="option menuOption-Content"><span class="vlts-menu opt fix-cursor-default menu-Option" data-fn-type="copyText"><i class="fa fa-copy fa-fw"></i> 复制文本</span><span class="vlts-menu opt fix-cursor-default menu-Option" data-fn-type="copyPaste"><i class="fa fa-paste fa-fw mR12"></i> 粘贴文本</span><span class="vlts-menu opt fix-cursor-default menu-Option" data-fn-type="copySelect"><i class="fa fa-object-ungroup fa-fw mR12"></i> 全选文本</span><span class="vlts-menu opt fix-cursor-default menu-Option" data-fn-type="copyCut"><i class="fa fa-cut fa-fw mR12"></i> 剪切文本</span><span class="vlts-menu opt fix-cursor-default menu-Option" data-fn-type="openTab"><i class="fa fa-external-link-square-alt fa-fw mR12"></i> 在新标签页打开</span><span class="vlts-menu opt fix-cursor-default menu-Option" data-fn-type="copySrc"><i class="fa fa-image fa-fw mR12"></i> 复制图片地址</span><span class="vlts-menu opt fix-cursor-default menu-Option" data-fn-type="copyImg"><i class="fa fa-images fa-fw mR12"></i> 复制图片文件</span></li><hr class="menuLoad-Content"><li class="menuLoad-Content"><a class="vlts-menu fix-cursor-default" href="https://volantis.js.org/faqs/" id="https:volantisjsorgfaqs" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-question fa-fw"></i> 常见问题</a></li><li class="menuLoad-Content"><a class="vlts-menu fix-cursor-default" href="https://volantis.js.org/examples/" id="https:volantisjsorgexamples" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-rss fa-fw"></i> 示例博客</a></li><li class="menuLoad-Content"><a class="vlts-menu fix-cursor-default" href="https://volantis.js.org/contributors/" id="https:volantisjsorgcontributors" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fan fa-spin fa-fw"></i> 加入社区</a></li><hr class="menuLoad-Content"><li class="menuLoad-Content"><a class="vlts-menu fix-cursor-default" href="https://github.com/volantis-x/volantis-docs/" id="https:githubcomvolantis-xvolantis-docs" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-code-branch fa-fw"></i> 本站源码</a></li><li class="menuLoad-Content"><a class="vlts-menu fix-cursor-default" href="https://github.com/volantis-x/hexo-theme-volantis/" id="https:githubcomvolantis-xhexo-theme-volantis" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-code-branch fa-fw"></i> 主题源码</a></li><hr class="menuLoad-Content"><li class="option menuOption-Content"><span class="vlts-menu opt fix-cursor-default" id="printHtml"><i class="fa fa-print fa-fw"></i> 打印页面</span></li><li class="option menuOption-Content"><span class="vlts-menu opt fix-cursor-default toggle-mode-btn" id="menuDarkBtn"><i class="fa fa-moon fa-fw"></i> 暗黑模式</span></li><hr class="menuLoad-Content"><li class="music name menuOption-Content"><p class="nav music-title fix-cursor-default"></p></li><li class="music ctrl"><a class="nav icon-only backward fix-cursor-default" onclick="aplayerBackward()"><i class="fa fa-step-backward fa-fw"></i></a><a class="nav icon-only toggle fix-cursor-default" onclick="aplayerToggle()"><i class="fa fa-play fa-fw"></i></a><a class="nav icon-only forward fix-cursor-default" onclick="aplayerForward()"><i class="fa fa-step-forward fa-fw"></i></a></li><li class="music volume"><a class="nav volume"><div class="aplayer-volume-bar-wrap"><div class="aplayer-volume-bar fix-cursor-pointer"><div class="aplayer-volume"></div><i class="left fa fa-volume-off fa-fw"></i><i class="right fa fa-volume-up fa-fw"></i></div></div></a></li></ul></div><script>$((function(){RightMenu.init()}));const RightMenu=(()=>{const e={},t=$("#printHtml"),n=$("#menuDarkBtn"),o=$(".menuLoad-Content"),i=($(".menuOption-Content"),$("#rightmenu-wrapper")[0]),c=$("#rightmenu-content")[0],r=$('.menu-Option[data-fn-type="copyText"]'),a=$('.menu-Option[data-fn-type="copyPaste"]'),s=$('.menu-Option[data-fn-type="copySelect"]'),l=$('.menu-Option[data-fn-type="copyCut"]'),d=$('.menu-Option[data-fn-type="copyHref"]'),u=$('.menu-Option[data-fn-type="copySrc"]'),h=$('.menu-Option[data-fn-type="copyImg"]'),g=$('.menu-Option[data-fn-type="openTab"]'),p=/^((https|http)?:\/\/)+[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;return e.init=()=>{$(".menu-Option").hide()},e.initEvent=()=>{window.document.oncontextmenu=t=>t.ctrlKey||$(window).width()<=500?(e.hideMenu(),!0):e.popMenu(t),i.oncontextmenu=e=>(e.stopPropagation(),e.preventDefault(),!1),$(window).off("click.rightMenu").on("click.rightMenu",()=>{e.hideMenu()}),$(window).off("blur.rightMenu").on("blur.rightMenu",()=>{e.hideMenu()}),$(i).off("blur.rightMenu").on("blur.rightMenu",()=>{e.hideMenu()})},e.popMenu=t=>{let n=t.clientX,o=t.clientY,r=document.documentElement.clientWidth||document.body.clientWidth,a=document.documentElement.clientHeight||document.body.clientHeight;try{e.setMenuItem(t),$(i).focus(),i.style.display="block",i.style.zIndex="-2147483648";let s=c.offsetWidth,l=c.offsetHeight,d=n+s>r?n-s+10:n,u=o+l>a?o-l+10:o;i.style.left=d+"px",i.style.top=u+"px",i.style.zIndex="2147483648"}catch(e){return $(i).blur(),console.error(e),!0}return!1},e.setMenuItem=i=>{let c=!1;const m=i.target,f=window.getSelection().toString();if(g.hide(),n&&n.off("click.rightMenu").one("click.rightMenu",e=>{n.children().toggleClass("fa fa-moon"),n.children().toggleClass("fa fa-sun")}),$(m).is("input")||$(m).is("textarea")){const t=$(m).val();t.length>0?(s.show(),s.off("click.rightMenu").one("click.rightMenu",()=>{$(m).select()})):s.hide(),f?(l.show(),l.off("click.rightMenu").one("click.rightMenu",()=>{const n=m.selectionStart,o=m.selectionEnd;e.copyString(f),$(m).val(t.substring(0,n)+t.substring(o,t.length)),m.selectionStart=n,m.selectionEnd=n,$(m).focus()})):l.hide(),e.readClipboard().then(t=>{t?(a.show(),a.off("click.rightMenu").one("click.rightMenu",()=>{e.insertAtCaret($(m),t)})):a.hide()}).catch(e=>{console.error(e),a.hide()})}else s.hide(),a.hide(),l.hide();const w=m.href;w&&p.test(w)?(c=!0,d.show(),g.show(),d.off("click.rightMenu").one("click.rightMenu",()=>{e.copyString(w)}),g.off("click.rightMenu").one("click.rightMenu",()=>{window.open(w)})):d.hide();const y=m.currentSrc;y&&p.test(y)?(c=!0,u.show(),g.show(),u.off("click.rightMenu").one("click.rightMenu",()=>{e.copyString(y)}),g.off("click.rightMenu").one("click.rightMenu",()=>{window.open(y)})):u.hide(),y&&p.test(y)&&y.trimEnd().endsWith(".png")?(c=!0,h.show(),h.off("click.rightMenu").one("click.rightMenu",()=>{e.writeClipImg(i,()=>{volantis.message("操作提示","复制成功！","success")},e=>{volantis.message("操作提示","复制失败："+e,"error")})})):h.hide(),f?(c=!0,r.show(),r.off("click.rightMenu").one("click.rightMenu",()=>{e.copyString(f)})):r.hide();const b=$("#post.article").html()||null,M=window.location.pathname;b?(t.show(),t.off("click.rightMenu").one("click.rightMenu",t=>{window.location.pathname===M?e.printHtml():e.hideMenu()})):t.hide(),c?o.hide():o.show(),volantis.APlayerLoaded&&checkAPlayer()},e.hideMenu=()=>{i.style.display="none"},e.copyString=t=>{e.writeClipText(t).then(()=>{volantis.message("操作提示",t.length>120?t.substring(0,120)+"...":t,"info")}).catch(e=>{volantis.message("操作提示",e,"error")})},e.writeClipText=e=>{try{return navigator.clipboard.writeText(e).then(()=>Promise.resolve()).catch(e=>Promise.reject(e))}catch(t){const n=document.createElement("input");n.setAttribute("readonly","readonly"),document.body.appendChild(n),n.setAttribute("value",e),n.select();try{let e=document.execCommand("copy");return document.body.removeChild(n),e&&"unsuccessful"!==e?Promise.resolve():Promise.reject("复制文本失败!")}catch(e){return document.body.removeChild(n),Promise.reject("当前浏览器不支持复制功能，请检查更新或更换其他浏览器操作!")}}},e.writeClipImg=async function(e,t,n){const o=e.target.currentSrc,i=e.target.parentElement;try{const e=await fetch(o),i=await e.blob();await navigator.clipboard.write([new ClipboardItem({[i.type]:i})]).then(()=>{t()},e=>{console.error("图片复制失败：",e),n(e)})}catch(e){const o=document;try{if(o.body.createTextRange){const e=document.body.createTextRange();e.moveToElementText(i),e.select()}else if(window.getSelection){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(i),e.removeAllRanges(),e.addRange(t)}document.execCommand("copy"),window.getSelection().removeAllRanges(),t()}catch(e){console.error(e),n("不支持复制当前图片！")}}},e.readClipboard=async()=>{const e=await navigator.permissions.query({name:"clipboard-read"});return"granted"===e.state||"prompt"===e.state?navigator.clipboard.readText().then(e=>e).catch(e=>Promise.reject(e)):Promise.reject(e)},e.insertAtCaret=(e,t)=>{const n=e[0],o=n.selectionStart,i=n.selectionEnd;if(document.selection)e.focus(),document.selection.createRange().text=t,e.focus();else if(o||"0"==o){var c=n.scrollTop;n.value=n.value.substring(0,o)+t+n.value.substring(i,n.value.length),e.focus(),n.selectionStart=o+t.length,n.selectionEnd=o+t.length,n.scrollTop=c}else e.value+=t,e.focus()},e.printHtml=()=>{$("body").css({backgroundColor:"unset"}),$("#l_header").hide(),$("#l_cover").hide(),$("#l_side").hide(),$("#l_main").css({width:"100%"}),$("#post").css({"box-shadow":"none",background:"none",padding:"0"}),$("h1").css({"text-align":"center","font-weight":"600","font-size":"2rem","margin-bottom":"20px"}),$(".prev-next").hide(),$("#bottom").children().append('<div class="new-meta-item"><a class="tag" href="'+window.location.href+'" rel="nofollow" data-pjax-state=""><i class="fad fa-external-link fa-fw" aria-hidden="true"></i><p>本文地址：'+window.location.href+"</p></a></div>"),$("#comments").hide(),$("#s-top").hide(),$("footer").hide(),$("#rightmenu-wrapper").hide(),$("details").attr("open","true"),$(".tab-pane").css({display:"block"}),$(".tab-content").css({"border-top":"none"}),$(".highlight>table pre").css({"white-space":"pre-wrap","word-break":"break-all"}),$(".nav-tabs").hide(),$(".backstretch").hide(),$(".fancybox img").css({height:"auto",weight:"auto"}),$("img").removeAttr("srcset data-srcset").removeClass("img lazyload loaded"),$(document).click(),setTimeout(()=>{window.print(),document.body.innerHTML="",window.location.reload()},50)},{init:(t=!1)=>{e.init(),e.initEvent(),t&&volantis.message("操作提示","自定义右键注册成功。","success")},destroy:(t=!1)=>{e.hideMenu(),$(window).off("click.rightMenu"),$(window).off("blur.rightMenu"),$(i).off("blur.rightMenu"),window.document.oncontextmenu=()=>!0,t&&volantis.message("操作提示","自定义右键注销成功。","success")}}})()</script><script>const rootElement=document.documentElement,darkModeStorageKey="user-color-scheme",rootElementDarkModeAttributeName="data-user-color-scheme",setLS=(e,t)=>{localStorage.setItem(e,t)},removeLS=e=>{localStorage.removeItem(e)},getLS=e=>localStorage.getItem(e),getModeFromCSSMediaQuery=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",resetRootDarkModeAttributeAndLS=()=>{var e;rootElement.removeAttribute("data-user-color-scheme"),e=darkModeStorageKey,localStorage.removeItem(e)},validColorModeKeys={dark:!0,light:!0},applyCustomDarkModeSettings=e=>{const t=e||getLS(darkModeStorageKey);getCustomDarkMode(),t===getModeFromCSSMediaQuery()?resetRootDarkModeAttributeAndLS():validColorModeKeys[t]?rootElement.setAttribute("data-user-color-scheme",t):resetRootDarkModeAttributeAndLS()},invertDarkModeObj={dark:"light",light:"dark"},getCustomDarkMode=()=>{let e=getLS(darkModeStorageKey);if(validColorModeKeys[e])e=invertDarkModeObj[e];else{if(null!==e)return;e=invertDarkModeObj[getModeFromCSSMediaQuery()]}volantis.dark.mode="dark"==e?"light":"dark"},toggleCustomDarkMode=()=>{let e=getLS(darkModeStorageKey);if(validColorModeKeys[e])e=invertDarkModeObj[e];else{if(null!==e)return;e=invertDarkModeObj[getModeFromCSSMediaQuery()]}var t,o;return t=darkModeStorageKey,o=e,localStorage.setItem(t,o),e};volantis.dark.toggle=()=>{const e=toggleCustomDarkMode();applyCustomDarkModeSettings(e),volantis.dark.method.toggle.start()};var btn=$(".toggle-mode-btn","#wrapper,#rightmenu-wrapper");function bindToggleButton(){btn.on("click",volantis.dark.toggle)}applyCustomDarkModeSettings(),document.addEventListener("DOMContentLoaded",bindToggleButton),volantis.pjax.push(bindToggleButton),volantis.pjax.send(()=>{btn.unbind("click")},"toggle-mode-btn-unbind")</script><script>function loadIssuesJS(){if(volantis.plugins.sitesjs){null!=document.getElementById("sites-api")&&"undefined"==typeof SitesJS&&loadScript(volantis.plugins.sitesjs,{defer:!0})}if(volantis.plugins.friendsjs){null!=document.getElementById("friends-api")&&"undefined"==typeof FriendsJS&&loadScript(volantis.plugins.friendsjs,{defer:!0})}if(volantis.plugins.contributorsjs){null!=document.getElementById("contributors-api")&&"undefined"==typeof ContributorsJS&&loadScript(volantis.plugins.contributorsjs,{defer:!0})}}$((function(){loadIssuesJS()})),volantis.pjax.push(()=>{loadIssuesJS()})</script><script defer="defer" src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script><script>window.lazyLoadOptions={elements_selector:".lazyload",threshold:0},window.addEventListener("LazyLoad::Initialized",(function(n){window.lazyLoadInstance=n.detail.instance}),!1),document.addEventListener("DOMContentLoaded",(function(){lazyLoadInstance.update()})),document.addEventListener("pjax:complete",(function(){lazyLoadInstance.update()}))</script><script>window.FPConfig={delay:0,ignoreKeywords:[],maxRPS:5,hoverDelay:25}</script><script defer="defer" src="https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script><script>var clipboard=new ClipboardJS(".btn-copy",{target:function(e){return e.nextElementSibling}});function wait(e,i){window.setTimeout(e,i)}function pjax_initCopyCode(){if($(".highlight .code pre").length+$(".article pre code").length!=0){var e="";e+='<button class="btn-copy" data-clipboard-snippet="">',e+='<i class="fas fa-copy"></i><span>COPY</span>',e+="</button>",$(".highlight .code pre").before(e),$(".article pre code").before(e),clipboard.off("success").on("success",(function(e){let i=$(e.trigger);i.addClass("copied");let a=$(i.find("i"));a.removeClass("fa-copy"),a.addClass("fa-check-circle");let n=$(i.find("span"));n[0].innerText="COPIED",wait((function(){a.removeClass("fa-check-circle"),a.addClass("fa-copy"),n[0].innerText="COPY"}),2e3)})),clipboard.off("error").on("error",(function(e){e.clearSelection();let i=$(e.trigger);i.addClass("copy-failed");let a=$(i.find("i"));a.removeClass("fa-copy"),a.addClass("fa-times-circle");let n=$(i.find("span"));n[0].innerText="COPY FAILED",wait((function(){a.removeClass("fa-times-circle"),a.addClass("fa-copy"),n[0].innerText="COPY"}),2e3)}))}}$((function(){pjax_initCopyCode()})),volantis.pjax.push(pjax_initCopyCode)</script><script>let APlayerController=new Object;APlayerController.id="3175833810",APlayerController.volume="0.4",loadCSS("https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css"),loadScript("https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"),window.volantis.APlayerLoaded=0;var checkAPlayer=setInterval((function(){window.APlayer&&"block"==$("#safearea").css("display")&&(clearInterval(checkAPlayer),window.volantis.APlayerLoaded||window.MetingJSElement||(window.volantis.APlayerLoaded=1,loadScript("https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js")))}),100);loadScript("/js/aplayer.js")</script><script src="/js/valine.js"></script><script>function emoji(i,e,a){return i+"/"+i+"-"+e+"."+a}for(var emojiMaps={},i=1;i<=54;i++)emojiMaps["tieba-"+i]=emoji("tieba",i,"png");for(i=1;i<=101;i++)emojiMaps["qq-"+i]=emoji("qq",i,"gif");for(i=1;i<=116;i++)emojiMaps["aru-"+i]=emoji("aru",i,"gif");for(i=1;i<=125;i++)emojiMaps["twemoji-"+i]=emoji("twemoji",i,"png");for(i=1;i<=4;i++)emojiMaps["weibo-"+i]=emoji("weibo",i,"png");function pjax_valine(){if(!document.querySelectorAll("#valine_container")[0])return;let i=pdata.commentPlaceholder||"快来评论吧~",e=pdata.commentPath;if(0==e.length){e=""||decodeURI(window.location.pathname)}(new Valine).init(Object.assign({path:null,placeholder:"快来评论吧~",appId:"XkeYrd6r1FrJXgASPvPJa9Hp-gzGzoHsz",appKey:"de9Yfw8ns8xwf6S9eHOj82Wi",meta:["nick","mail","link"],requiredFields:["nick","mail"],enableQQ:!0,recordIP:!1,avatar:"robohash",pageSize:10,lang:"zh-cn",highlight:!0,mathJax:!1},{el:"#valine_container",path:e,placeholder:i,emojiCDN:"https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/",emojiMaps:emojiMaps}))}$((function(){pjax_valine()})),volantis.pjax.push(pjax_valine)</script><script src="/js/app.js"></script><script>const SearchServiceimagePath="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@master/img/",ROOT="/".endsWith("/")?"/":"//";function listenSearch(){customSearch=new HexoSearch({imagePath:SearchServiceimagePath})}function setSearchService(){listenSearch()}$(".input.u-search-input").one("focus",(function(){loadScript("/js/search/hexo.js",setSearchService)}))</script><script defer="defer">const LCCounter={app_id:"XkeYrd6r1FrJXgASPvPJa9Hp-gzGzoHsz",app_key:"de9Yfw8ns8xwf6S9eHOj82Wi",custom_api_server:"https://lcapi.tabris.top",getRecord:(e,t,r)=>new Promise((function(n,o){e("get","/classes/Counter?where="+encodeURIComponent(JSON.stringify({url:t}))).then(e=>e.json()).then(({results:i,code:s,error:a})=>{if(401===s)throw a;if(i&&i.length>0){var l=i[0];n(l)}else e("post","/classes/Counter",{url:t,title:r,times:0}).then(e=>e.json()).then((e,t)=>{if(t)throw t;n(e)}).catch(e=>{console.error("Failed to create",e),o(e)})}).catch(e=>{console.error("LeanCloud Counter Error:",e),o(e)})})),increment:(e,t)=>new Promise((function(r,n){e("post","/batch",{requests:t}).then(e=>{if((e=e.json()).error)throw e.error;r(e)}).catch(e=>{console.error("Failed to save visitor count",e),n(e)})})),buildIncrement:e=>({method:"PUT",path:"/1.1/classes/Counter/"+e,body:{times:{__op:"Increment",amount:1}}}),validUV(){var e="LeanCloudUVTimestamp",t=localStorage.getItem(e);return!(t&&(new Date).getTime()-parseInt(t)<=864e5)&&(localStorage.setItem(e,(new Date).getTime().toString()),!0)},addCount(e){var t=[],r=[],n=document.querySelector("#lc-sv"),o=this.getRecord(e,"http://blog.tabris.top/#lc-sv","Visits").then(e=>{r.push(this.buildIncrement(e.objectId));var t=document.querySelectorAll("#lc-sv #number");t.length>0&&t.forEach((t,r,o)=>{t.innerText=e.times+1,n&&(n.style.display="inline")})});t.push(o);var s=document.querySelector("#lc-uv"),a=this.getRecord(e,"http://blog.tabris.top/#lc-uv","Visitors").then(e=>{var t=this.validUV();t&&r.push(this.buildIncrement(e.objectId));var n=document.querySelectorAll("#lc-uv #number");n.length>0&&n.forEach((r,n,o)=>{r.innerText=e.times+(t?1:0),s&&(s.style.display="inline")})});t.push(a);var l=document.querySelectorAll("#lc-pv");for(l.length,i=0;i<l.length;i++){let n=l[i],o=n.getAttribute("data-title");var c="http://blog.tabris.top"+n.getAttribute("data-path");if(c){var h=this.getRecord(e,c,o).then(e=>{let t=window.location.pathname;if(t.includes("index.html")&&(t=t.substring(0,t.lastIndexOf("index.html"))),n.getAttribute("data-path")==t&&r.push(this.buildIncrement(e.objectId)),n){var o=n.querySelector("#lc-pv #number");o&&(n.getAttribute("data-path")==t?o.innerText=(e.times||0)+1:o.innerText=e.times||0,n.style.display="inline")}});t.push(h)}}Promise.all(t).then(()=>{r.length>0&&this.increment(e,r)})},fetchData(e){this.addCount((t,r,n)=>fetch(`${e}/1.1${r}`,{method:t,headers:{"X-LC-Id":this.app_id,"X-LC-Key":this.app_key,"Content-Type":"application/json"},body:JSON.stringify(n)}))},refreshCounter(){var e="-MdYXbMMI"!==this.app_id.slice(-9)?this.custom_api_server:`https://${this.app_id.slice(0,8).toLowerCase()}.api.lncldglobal.com`;e?this.fetchData(e):fetch("https://app-router.leancloud.cn/2/route?appId="+this.app_id).then(e=>e.json()).then(({api_server:e})=>{this.fetchData("https://"+e)})}};LCCounter.refreshCounter(),document.addEventListener("pjax:complete",(function(){LCCounter.refreshCounter()}))</script><script>var imgs=["https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/042.jpg"],index=0;function shuffle(a){for(var l=a.length;l--;){var e=Math.floor(Math.random()*l),r=a[e];a[e]=a[l],a[l]=r}}function parallax(a){$("#parallax-window").parallax({src:a,speed:.25,bleed:0,zIndex:-100,posX:"center",posY:"center",overScrollFix:!1,excludeAgents:/(iPod|iPhone|iPad|Android)/,aspectRatio:null,sliderSelector:">.parallax-slider",mirrorSelector:"#l_cover",afterRefresh:()=>{},afterRender:()=>{},afterSetup:()=>{},afterDestroy:()=>{}})}function next_parallax(){$("#l_cover .parallax-mirror img")[0].src=imgs[index%imgs.length],index++,fetch(imgs[index%imgs.length])}function pjax_parallax(){next_parallax(),volantis.IntervalParallax=setInterval((function(){next_parallax()}),15e3)}shuffle(imgs),loadScript("/js/jquery.parallax.min.js");var checkParallax=setInterval((function(){"block"==$("#safearea").css("display")&&void 0!==$("#parallax-window").parallax&&(clearInterval(checkParallax),parallax(imgs[index%imgs.length]))}),500);volantis.pjax.push(pjax_parallax),volantis.pjax.send(()=>{try{clearInterval(volantis.IntervalParallax)}catch(a){}},"pjax_parallax")</script><script>volantis.message=(s,e,a,t=3e3,i)=>{if(void 0===$.message){loadCSS("/css/message.css"),loadScript("/js/message.js",()=>{m(s,e,a,i,t)})}else m(s,e,a,i,t);function m(s,e,a,t,i){$.message({title:s,message:e,type:a,autoClose:t,time:i})}}</script><script>function listennSidebarTOC(){const e=document.querySelectorAll(".toc li");if(!e.length)return;const t=[...e].map(e=>{const t=e.querySelector(".toc-link"),n=document.getElementById(decodeURI(t.getAttribute("href")).replace("#",""));return t.addEventListener("click",e=>{e.preventDefault(),window.scrollTo({top:n.offsetTop+100,behavior:"smooth"})}),n});!function n(o){o=Math.floor(o+1e4);let r=new IntersectionObserver((r,c)=>{let i=document.documentElement.scrollHeight+100;if(i>o)return c.disconnect(),void n(i);let l=function(e){let n=0,o=e[n];if(o.boundingClientRect.top>0)return n=t.indexOf(o.target),0===n?0:n-1;for(;n<e.length;n++){if(!(e[n].boundingClientRect.top<=0))return t.indexOf(o.target);o=e[n]}return t.indexOf(o.target)}(r);!function(e){if(e.classList.contains("active-current"))return;document.querySelectorAll(".toc .active").forEach(e=>{e.classList.remove("active","active-current")}),e.classList.add("active","active-current");let t=e.parentNode;for(;!t.matches(".toc");)t.matches("li")&&t.classList.add("active"),t=t.parentNode}(e[l])},{rootMargin:o+"px 0px -100% 0px",threshold:0});t.forEach(e=>{e&&r.observe(e)})}(document.documentElement.scrollHeight)}document.addEventListener("DOMContentLoaded",listennSidebarTOC),document.addEventListener("pjax:success",listennSidebarTOC)</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>var pjax;document.addEventListener("DOMContentLoaded",(function(){pjax=new Pjax({elements:'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',selectors:["title","#pjax-container","#pjax-header-nav-list"],cacheBust:!1,timeout:5e3})})),document.addEventListener("pjax:send",(function(e){try{var n=window.location.pathname,t=e.triggerElement.href,a=[""];""!=a[0]&&a.forEach(e=>{-1==n.indexOf(e)&&-1==t.indexOf(e)||(window.location.href=t)})}catch(e){}volantis.$.switcher.removeClass("active"),volantis.$.header.removeClass("z_search-open"),volantis.$.wrapper.removeClass("sub"),volantis.$.topBtn.unbind("click"),$(".menu a","#l_header,#l_cover").unbind("click"),$(window).unbind("resize"),$(window).unbind("scroll"),$(document).unbind("scroll"),$(document).unbind("click"),$("body").unbind("click"),volantis.pjax.method.send.start()})),document.addEventListener("pjax:complete",(function(){$("script[data-pjax], .pjax-reload script").each((function(){$(this).parent().append($(this).remove())})),volantis.pjax.method.complete.start()})),document.addEventListener("pjax:error",(function(e){volantis.pjax.method.error.start(),window.location.href=e.triggerElement.href}))</script></div></body></html>